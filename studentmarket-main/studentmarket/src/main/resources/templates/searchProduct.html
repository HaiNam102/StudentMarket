<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Tìm kiếm sản phẩm</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }
        h1 { margin: 0 0 12px 0; }
        form.search { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 20px; }
        .results { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 16px; }
        .card { border: 1px solid #eee; border-radius: 10px; padding: 12px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
        .card img { width: 100%; height: 160px; object-fit: cover; border-radius: 8px; }
        .meta { display: flex; gap: 8px; font-size: 12px; color: #666; margin: 6px 0; flex-wrap: wrap; }
        .price { font-weight: 700; margin: 6px 0; }
        .badges { display: flex; gap: 6px; font-size: 12px; }
        .badge { padding: 2px 6px; border-radius: 999px; background: #f3f4f6; }
        .badge.hot { background: #fee2e2; color: #b91c1c; }
        .empty { padding: 24px; border: 1px dashed #ddd; text-align: center; border-radius: 10px; }
        .pagination { display: flex; align-items: center; gap: 8px; margin-top: 20px; }
        .pagination a, .pagination span {
          padding: 6px 10px; border: 1px solid #e5e7eb; border-radius: 6px; text-decoration: none; color: #111827;
        }
        .pagination .current { background: #111827; color: #fff; border-color: #111827; }
        /* Debug table */
        details summary { cursor: pointer; margin: 14px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { border: 1px solid #eee; padding: 6px 8px; text-align: left; }
        th { background: #fafafa; }
        @media (max-width: 1024px) { .results { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 640px)  { .results { grid-template-columns: 1fr; } form.search{ grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<h1>Danh sách sản phẩm</h1>

<!-- Form tìm kiếm: bind với @ModelAttribute("products") SearchReqDTO -->
<form class="search" th:action="@{/searchProduct}" th:object="${products}" method="get">
    <label>
        Tên sản phẩm
        <input th:field="*{name}" type="text" placeholder="vd: iPhone, Dell, ..." />
    </label>

    <label>
        Khu vực
        <input th:field="*{location}" type="text" placeholder="vd: Hà Nội, TP.HCM, ..." />
    </label>

    <label>
        Danh mục con (ID)
        <input th:field="*{childCategoryId}" type="number" min="1" placeholder="vd: 2" />
    </label>

    <div>
        <button type="submit">Tìm</button>
    </div>
</form>

<!-- Tóm tắt kết quả -->
<p th:if="${page != null}" style="color:#6b7280;">
    Tìm thấy <b th:text="${page.totalElements}">0</b> sản phẩm ·
    Trang <b th:text="${page.number + 1}">1</b>/<span th:text="${page.totalPages}">1</span>
</p>

<!-- Lưới sản phẩm -->
<div th:if="${page != null and page.totalElements > 0}" class="results">
    <div class="card" th:each="p : ${page.content}">
        <div>
            <img th:if="${p.imageUrl}" th:src="${p.imageUrl}" alt="Ảnh sản phẩm" />
        </div>

        <div class="meta">
            <span th:text="${p.relativeTime}">Hôm nay</span>
            <span th:text="${p.location}">Vị trí</span>
        </div>

        <h3 th:text="${p.name}">Tên sản phẩm</h3>
        <div class="price" th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')} + ' đ'">0 đ</div>
        <p th:text="${p.shortDescription}">Mô tả ngắn...</p>

        <div class="badges">
            <span class="badge" th:text="${p.status}">AVAILABLE</span>
            <span class="badge hot" th:if="${p.isHot}">HOT</span>
        </div>
    </div>
</div>

<div class="empty" th:if="${page == null or page.totalElements == 0}">
    Chưa có sản phẩm nào khớp tiêu chí.
</div>

<!-- Phân trang -->
<div class="pagination" th:if="${page != null and page.totalPages > 1}">
     <a th:if="${!page.first}"
         th:href="@{/searchProduct(name=${products.name}, location=${products.location}, childCategoryId=${products.childCategoryId}, page=${page.number-1}, size=${size})}">« Trước</a>

    <span th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
          th:classappend="${i} == ${page.number} ? 'current'">
     <a th:if="${i != page.number}"
         th:text="${i + 1}"
         th:href="@{/searchProduct(name=${products.name}, location=${products.location}, childCategoryId=${products.childCategoryId}, page=${i}, size=${size})}">1</a>
    <span th:if="${i == page.number}" th:text="${i + 1}">1</span>
  </span>

     <a th:if="${!page.last}"
         th:href="@{/searchProduct(name=${products.name}, location=${products.location}, childCategoryId=${products.childCategoryId}, page=${page.number+1}, size=${size})}">Sau »</a>
</div>

</body>
</html>
