<!doctype html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student Market - Website trao ƒë·ªïi v√† mua b√°n ƒë·ªì d√πng c≈© d√†nh cho sinh vi√™n DTU</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        .menu-parent:hover .menu-child {
            display: block;
        }
    </style>
</head>

<body class="bg-gray-100">
    <!-- Overlay n·ªÅn m·ªù -->
    <div id="overlay" class="hidden fixed inset-0 bg-black/50 z-40"></div>

    <!-- Header -->
    <div th:replace="~{fragments/headerUSER :: headerUSER}"></div>

    <!-- MAIN -->
    <main class="pt-14 pb-10">
        <div class="max-w-7xl mx-auto px-4 pt-9">

            <!-- Ph·∫ßn tr√™n: H·ªì s∆° (PROFILE) -->
            <div th:replace="~{fragments/hosoprofile :: hosoprofile}"></div>

            <!-- Layout 2 c·ªôt -->
            <div class="flex flex-col md:flex-row gap-6">

                <!-- Main Container -->
                <div class="flex flex-col md:flex-row gap-6">

                    <!-- Sidebar -->
                    <aside class="md:col-span-3">
                        <nav class="bg-white rounded-2xl shadow divide-y top-24 w-[245px]">

                            <a class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50 rounded-tl-2xl rounded-tr-2xl"
                                th:href="@{/tongquan}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/home.png}" alt="T·ªïng Quan"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-gray-800 font-semibold">T·ªïng Quan</span>
                            </a>

                            <a class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50"
                                th:href="@{/thongtintaikhoan}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/setting.png}" alt="Th√¥ng tin t√†i kho·∫£n"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-gray-800 font-semibold">Th√¥ng tin t√†i kho·∫£n</span>
                            </a>

                            <a class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50" th:href="@{/quanlybaidang}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/edit.png}" alt="Qu·∫£n l√≠ b√†i ƒëƒÉng"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-gray-800 font-semibold">Qu·∫£n l√Ω b√†i ƒëƒÉng</span>
                            </a>

                            <a class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50" th:href="@{/lichsugiaodich}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/file.png}" alt="L·ªãch s·ª≠ giao d·ªãch"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-gray-800 font-semibold">L·ªãch s·ª≠ giao d·ªãch</span>
                            </a>

                            <a class="flex items-center gap-3 px-6 py-3 bg-red-50" th:href="@{/tichluydiem}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/tichluy-red.png}" alt="T√≠ch l≈©y ƒëi·ªÉm"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-red-600 font-semibold">T√≠ch l≈©y ƒëi·ªÉm</span>
                            </a>

                            <a class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50" th:href="@{/danhgia}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/danhgia.png}" alt="ƒê√°nh gi√°"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-gray-800 font-semibold">ƒê√°nh gi√°</span>
                            </a>

                            <a class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50" th:href="@{/gopy}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/gopy.png}" alt="G√≥p √Ω & h·ªó tr·ª£"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-gray-800 font-semibold">G√≥p √Ω & h·ªó tr·ª£</span>
                            </a>

                            <a class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50" th:href="@{/dieukhoansudung}">
                                <!-- Icon b·∫±ng ·∫£nh -->
                                <img th:src="@{/image/thongtintaikhoan/dieukhoan.png}" alt="ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng"
                                    class="w-6 h-6 object-cover" />
                                <!-- N·ªôi dung -->
                                <span class="text-gray-800 font-semibold">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</span>
                            </a>

                            <form th:action="@{/logout}" method="post"
                                class="flex items-center gap-3 px-6 py-3 hover:bg-gray-50 rounded-bl-2xl rounded-br-2xl">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="button"
                                    class="js-logout-trigger flex items-center gap-3 w-full text-left">
                                    <!-- Icon b·∫±ng ·∫£nh -->
                                    <img th:src="@{/image/thongtintaikhoan/dangxuat.png}" alt="ƒêƒÉng xu·∫•t"
                                        class="w-6 h-6 object-cover" />
                                    <!-- N·ªôi dung -->
                                    <span class="text-gray-800 font-semibold">ƒêƒÉng xu·∫•t</span>
                                </button>
                            </form>
                        </nav>
                    </aside>

                    <!-- HUY HI·ªÜU / ƒêI·ªÇM -->
                    <section class="flex-1">
                        <!-- ƒêang s·ª≠ d·ª•ng -->
                        <div class="bg-white rounded-2xl shadow p-6 w-[980px] mx-auto" id="activeBadgeBox"
                            style="padding-top: 10px;">
                            <div class="text-center">
                                <p class="text-red-600 font-bold">Huy hi·ªáu ƒëang s·ª≠ d·ª•ng</p>
                                <div class="h-0.5 w-64 bg-red-500 mx-auto rounded-full mt-2"></div>

                                <!-- ·∫¢nh huy hi·ªáu l·ªõn -->
                                <div class="mt-4 flex items-center justify-center">
                                    <img id="activeBadgeImg" src="image/tichluydiem/b1.png" alt="Huy hi·ªáu ƒëang s·ª≠ d·ª•ng"
                                        class="w-28 h-28 object-contain">
                                </div>
                                <p id="activeBadgePoints" class="mt-2 text-lg font-bold text-gray-900">150 ƒëi·ªÉm</p>
                            </div>
                        </div>

                        <!-- B·ªô s∆∞u t·∫≠p huy hi·ªáu -->
                        <div class="mt-6 bg-white rounded-2xl shadow p-6">
                            <h3 class="text-base font-bold text-gray-900 mb-3">Chinh ph·ª•c huy hi·ªáu</h3>

                            <div id="badgeGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">

                                <!-- 10 ƒëi·ªÉm -->
                                <div class="text-center badge-item" data-points="10"
                                    data-img="image/tichluydiem/b4.png">
                                    <img src="image/tichluydiem/b4.png" alt="10 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">10 ƒëi·ªÉm</p>
                                    <button
                                        class="badge-btn inline-block mt-1 px-3 py-1 text-xs rounded-full bg-black text-white shadow">S·ª≠
                                        d·ª•ng</button>
                                </div>

                                <!-- 50 ƒëi·ªÉm -->
                                <div class="text-center badge-item" data-points="50"
                                    data-img="image/tichluydiem/b3.png">
                                    <img src="image/tichluydiem/b3.png" alt="50 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">50 ƒëi·ªÉm</p>
                                    <button
                                        class="badge-btn inline-block mt-1 px-3 py-1 text-xs rounded-full bg-black text-white shadow">S·ª≠
                                        d·ª•ng</button>
                                </div>

                                <!-- 100 ƒëi·ªÉm -->
                                <div class="text-center badge-item" data-points="100"
                                    data-img="image/tichluydiem/b2.png">
                                    <img src="image/tichluydiem/b2.png" alt="100 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">100 ƒëi·ªÉm</p>
                                    <button
                                        class="badge-btn inline-block mt-1 px-3 py-1 text-xs rounded-full bg-black text-white shadow">S·ª≠
                                        d·ª•ng</button>
                                </div>

                                <!-- 150 ƒëi·ªÉm (ƒëang d√πng) -->
                                <div class="text-center badge-item" data-points="150"
                                    data-img="image/tichluydiem/b1.png">
                                    <img src="image/tichluydiem/b1.png" alt="150 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">150 ƒëi·ªÉm</p>
                                    <button
                                        class="badge-btn inline-block mt-1 px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-600 border border-blue-200">ƒêang
                                        s·ª≠ d·ª•ng</button>
                                </div>


                                <!-- 200 ƒëi·ªÉm (ƒë·ªß ƒë·ªÉ ƒë·ªïi) -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/v4.png" alt="200 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">200 ƒëi·ªÉm</p>
                                    <button
                                        class="inline-flex items-center justify-center mt-1 px-3 py-1 text-xs rounded-full border border-red-400 text-red-500 hover:bg-red-50">
                                        ƒê·ªïi
                                    </button>
                                </div>

                                <!-- 250 ƒëi·ªÉm -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/v3.png" alt="250 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">250 ƒëi·ªÉm</p>
                                    <span
                                        class="inline-block mt-1 px-3 py-1 text-xs rounded-full border border-gray-300 text-gray-600">Ch∆∞a
                                        ƒë·ªß</span>
                                </div>

                                <!-- 300 ƒëi·ªÉm -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/v2.png" alt="300 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">300 ƒëi·ªÉm</p>
                                    <span
                                        class="inline-block mt-1 px-3 py-1 text-xs rounded-full border border-gray-300 text-gray-600">Ch∆∞a
                                        ƒë·ªß</span>
                                </div>

                                <!-- 350 ƒëi·ªÉm -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/v1.png" alt="350 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">350 ƒëi·ªÉm</p>
                                    <span
                                        class="inline-block mt-1 px-3 py-1 text-xs rounded-full border border-gray-300 text-gray-600">Ch∆∞a
                                        ƒë·ªß</span>
                                </div>

                                <!-- 400 ƒëi·ªÉm -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/kc4.png" alt="400 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">400 ƒëi·ªÉm</p>
                                    <span
                                        class="inline-block mt-1 px-3 py-1 text-xs rounded-full border border-gray-300 text-gray-600">Ch∆∞a
                                        ƒë·ªß</span>
                                </div>

                                <!-- 450 ƒëi·ªÉm -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/kc3.png" alt="450 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">450 ƒëi·ªÉm</p>
                                    <span
                                        class="inline-block mt-1 px-3 py-1 text-xs rounded-full border border-gray-300 text-gray-600">Ch∆∞a
                                        ƒë·ªß</span>
                                </div>

                                <!-- 500 ƒëi·ªÉm -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/kc2.png" alt="500 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">500 ƒëi·ªÉm</p>
                                    <span
                                        class="inline-block mt-1 px-3 py-1 text-xs rounded-full border border-gray-300 text-gray-600">Ch∆∞a
                                        ƒë·ªß</span>
                                </div>

                                <!-- 550 ƒëi·ªÉm -->
                                <div class="text-center">
                                    <img src="image/tichluydiem/kc1.png" alt="550 ƒëi·ªÉm"
                                        class="mx-auto w-24 h-24 object-contain">
                                    <p class="mt-2 font-semibold text-gray-900">550 ƒëi·ªÉm</p>
                                    <span
                                        class="inline-block mt-1 px-3 py-1 text-xs rounded-full border border-gray-300 text-gray-600">Ch∆∞a
                                        ƒë·ªß</span>
                                </div>

                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <!-- Overlay cho modal -->
    <div id="modalOverlay" class="hidden fixed inset-0 bg-black/50 z-[9998]"></div>
    <!-- Modal x√°c nh·∫≠n ƒëƒÉng xu·∫•t -->
    <div th:replace="~{fragments/modallogout :: modallogout}"></div>

    <!-- FOOTER -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
        const badgeBtns = document.querySelectorAll('.badge-btn');
        const activeBadgeImg = document.getElementById('activeBadgeImg');
        const activeBadgePoints = document.getElementById('activeBadgePoints');
        const userBadgeImg = document.getElementById('userBadgeImg'); // üëà th√™m d√≤ng n√†y

        badgeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Reset t·∫•t c·∫£ n√∫t "ƒêang s·ª≠ d·ª•ng" th√†nh "S·ª≠ d·ª•ng"
                badgeBtns.forEach(b => {
                    b.textContent = "S·ª≠ d·ª•ng";
                    b.className = "badge-btn inline-block mt-1 px-3 py-1 text-xs rounded-full bg-black text-white shadow";
                });

                // Chuy·ªÉn n√∫t hi·ªán t·∫°i sang "ƒêang s·ª≠ d·ª•ng"
                btn.textContent = "ƒêang s·ª≠ d·ª•ng";
                btn.className = "badge-btn inline-block mt-1 px-3 py-1 text-xs rounded-full bg-blue-100 text-blue-600 border border-blue-200";

                // L·∫•y d·ªØ li·ªáu huy hi·ªáu
                const badgeItem = btn.closest('.badge-item');
                const imgSrc = badgeItem.getAttribute('data-img');
                const points = badgeItem.getAttribute('data-points');

                // C·∫≠p nh·∫≠t ph·∫ßn "Huy hi·ªáu ƒëang s·ª≠ d·ª•ng"
                activeBadgeImg.src = imgSrc;
                activeBadgeImg.alt = `Huy hi·ªáu ${points} ƒëi·ªÉm`;
                activeBadgePoints.textContent = `${points} ƒëi·ªÉm`;

                // üëâ ƒê·ªìng b·ªô huy hi·ªáu c·∫°nh t√™n user
                if (userBadgeImg) {
                    userBadgeImg.src = imgSrc;
                    userBadgeImg.alt = `Huy hi·ªáu ${points} ƒëi·ªÉm`;
                }
            });
        });

        // JS x·ª≠ l√Ω ƒëƒÉng xu·∫•t
        (() => {
            const overlay = document.getElementById('modalOverlay');
            const modal = document.getElementById('logoutConfirm');
            const btnOK = document.getElementById('logoutSubmit');
            const btnNO = document.getElementById('logoutCancel');

            let targetForm = null; // form s·∫Ω ƒë∆∞·ª£c submit khi b·∫•m "C√≥"

            function openModal(form) {
                targetForm = form;
                overlay.classList.remove('hidden');
                modal.classList.remove('hidden');
            }
            function closeModal() {
                overlay.classList.add('hidden');
                modal.classList.add('hidden');
                targetForm = null;
            }

            // B·∫Øt c√°c n√∫t logout
            document.querySelectorAll('.js-logout-trigger').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const form = btn.closest('form');
                    if (!form) return;
                    openModal(form);
                });
            });

            // N√∫t "Kh√¥ng"
            btnNO.addEventListener('click', (e) => {
                e.preventDefault();
                closeModal();
            });

            // N√∫t "C√≥"
            btnOK.addEventListener('click', (e) => {
                e.preventDefault();
                if (targetForm) {
                    // tr√°nh submit ƒë√¥i
                    btnOK.disabled = true;
                    targetForm.submit();
                } else {
                    closeModal();
                }
            });

            // Click ra ngo√†i h·ªôp => ƒë√≥ng
            modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal();
            });
            overlay.addEventListener('click', closeModal);
        })();

        // H√†m l·∫•y CSRF token
        function getCSRFToken() {
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            if (csrfToken) {
                return '_csrf=' + encodeURIComponent(csrfToken.getAttribute('content'));
            }
            return '';
        }
    </script>


    <!-- JS c·ªßa ph·∫ßn Header kh√¥ng ƒë∆∞·ª£c x√≥a -->
    <script>
        const overlay = document.getElementById('overlay');
        const dropdowns = {
            menuBtn: 'menuDropdown',
            favBtn: 'favDropdown',
            notiBtn: 'notiDropdown',
            avatarBtn: 'dropdownMenu'
        };

        Object.entries(dropdowns).forEach(([btnId, menuId]) => {
            const btn = document.getElementById(btnId);
            const menu = document.getElementById(menuId);

            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = !menu.classList.contains('hidden');

                Object.values(dropdowns).forEach(id =>
                    document.getElementById(id).classList.add('hidden')
                );

                if (isOpen) {
                    menu.classList.add('hidden');
                    overlay.classList.add('hidden');
                } else {
                    menu.classList.remove('hidden');
                    overlay.classList.remove('hidden');
                }
            });
        });

        overlay.addEventListener('click', () => {
            overlay.classList.add('hidden');
            Object.values(dropdowns).forEach(id =>
                document.getElementById(id).classList.add('hidden')
            );
        });

        document.addEventListener('click', (e) => {
            if (!Object.keys(dropdowns).some(btnId =>
                document.getElementById(btnId).contains(e.target)
            )) {
                overlay.classList.add('hidden');
                Object.values(dropdowns).forEach(id =>
                    document.getElementById(id).classList.add('hidden')
                );
            }
        });
    </script>

    <script th:src="@{/js/favorite.js}"></script>
    
</body>

</html>